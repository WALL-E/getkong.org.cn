<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">
  
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Lua Reference - kong.dao - v0.9.x | Kong - Open-Source API Management and Microservice Management</title>
  <meta name="description" content="Secure, Manage & Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more.">
  <meta name="author" content="Mashape"/>
  <meta property="og:title" content="Open-Source API Management and Microservice Management"/>
  <meta property="og:site_name" content="Kong"/>
  <!-- use share link for facebook -->
  <meta property="og:url" content="http://getkong.org"/>
  <meta property="og:description" content="Secure, Manage & Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more."/>
  <meta property="og:type" content="website"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:image" content="https://getkong.org/assets/images/share.png"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:site" content="@mashape"/>
  <meta name="twitter:creator" content="@mashape"/>
  <meta name="twitter:url" content="https://getkong.org"/>
  <meta name="twitter:description" content="Secure, Manage & Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more.">
  <meta name="twitter:image" content="https://getkong.org/assets/images/share.png">
  <meta property="fb:admins" content="227304446"/>
  <meta property="fb:admins" content="576641408"/>
  <meta name="google-site-verification" content="CrU3zp02dNKTe8NSAipL4NCPkrIjDXG8fViTZ-MIzP4"/>
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "Mashape",
      "url": "https://getkong.org",
      "logo": "https://getkong.org/assets/images/logo.png",
      "sameAs": [
        "https://www.facebook.com/Mashape",
        "https://twitter.com/mashape",
        "https://plus.google.com/+mashape"
      ]
    }
  </script>
  <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"/>
  <link rel="stylesheet" href="//cloud.typography.com/7506032/804186/css/fonts.css"/>
  <link rel="stylesheet" href="/assets/styles.css?v=1474440736"/>
</head>


  <body id="" >
    <header class="site-header">
  <div class="enterprise">
    <div class="container">
      <nav class="enterprise-sites one-half column">
        <ul>
          <li class="active"><a href="http://getkong.org">Kong</a></li>
          <li><a href="http://gelato.io">Gelato</a></li>
          <li><a href="http://getgalileo.io">Galileo</a></li>
          <li><a href="http://www.mashape.com/enterprise/">Enterprise</a></li>
        </ul>
      </nav>
      <nav class="enterprise-contact one-half column">
        <ul>
          <li><a href="https://www.mashape.com/enterprise/#demo-form">Request Demo</a></li>
          <li><a href="tel:+18664021473">Sales: +1 (866) 402-1473</a></li>
        </ul>
      </nav>
    </div>
  </div><!-- .enterprise -->
  <div class="navbar">
    <div class="container">
      <a href="/" class="navbar-brand"><img src="/assets/images/branding.svg" alt="Kong" width="99" height="32"></a>
      <iframe class="header-star" src="https://ghbtns.com/github-btn.html?user=Mashape&amp;repo=kong&amp;type=star"frameborder="0" scrolling="0" width="55" height="20"></iframe>
      <button data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar" class="navbar-toggle">
        <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
      </button>
      <nav id="navbar" class="navbar-nav">
        <ul>
          <li><a href="/about/" >About</a></li>
          <li><a href="/docs/"  class="active">Docs</a></li>
          <li><a href="/plugins/" >Plugins</a></li>
          <li><a href="/community/" >Community</a></li>
          <li><a href="https://www.mashape.com/enterprise/">Enterprise</a></li>
          <li><a href="https://github.com/Mashape/kong" target="_blank">GitHub</a></li>
          <li>
            <a href="/install/" class="button button-dark" data-analytics='{"event": "Clicked download", "type": "button", "location": "header"}'>Installation</a>
          </li>
        </ul>
      </nav>
    </div>
  </div><!-- .navbar -->
</header>


    <header class="page-header">
  <div class="container">
    <div class="page-header-icon">
      <img src="/assets/images/icons/icn-documentation.svg" alt="Documentation" />
    </div>
    <div class="page-header-title">
      <h1>Public Lua API Reference</h1>
      <p>For plugins developers and core contributors</p>
    </div>
    
      <div class="dropdown page-header-right">
        <button class="page-header-btn" id="version-dropdown" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Version 0.9.x
          <em>(latest)</em>
          <span class="caret"></span>
        </button>

        <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="version-dropdown">
          
            
              <li>
                
                  <span>Not available for 0.2.0-2</span>
                
              </li>
            
          
            
              <li>
                
                  <span>Not available for 0.2.x</span>
                
              </li>
            
          
            
              <li>
                
                  <span>Not available for 0.3.x</span>
                
              </li>
            
          
            
              <li>
                
                  <span>Not available for 0.4.x</span>
                
              </li>
            
          
            
              <li>
                
                  <a href="/docs/0.5.x/lua-reference/">
                    0.5.x
                    
                  </a>
                
              </li>
            
          
            
              <li>
                
                  <a href="/docs/0.6.x/lua-reference/">
                    0.6.x
                    
                  </a>
                
              </li>
            
          
            
              <li>
                
                  <a href="/docs/0.7.x/lua-reference/">
                    0.7.x
                    
                  </a>
                
              </li>
            
          
            
              <li>
                
                  <a href="/docs/0.8.x/lua-reference/">
                    0.8.x
                    
                  </a>
                
              </li>
            
          
            
          
        </ul>
      </div>
    
  </div>
</header>

<div class="container">
  <aside class="page-navigation">
    <nav>
      <ul>
        <li>
          <a href="/docs/0.9.x"><h5>Back to docs</h5></a>
        </li>
        <li>
          <a href="/docs/0.9.x/lua-reference/"><h5>Index</h5></a>
        </li>
        <li>
          <h5>Modules</h5>
          <ul>
            <li>kong.dao</li>
            <li><a href="../../modules/kong.plugins.basic-auth.crypto">kong.plugins.basic-auth.crypto</a></li>
            <li><a href="../../modules/kong.plugins.jwt.jwt_parser">kong.plugins.jwt.jwt_parser</a></li>
            <li><a href="../../modules/kong.plugins.log-serializers.alf">kong.plugins.log-serializers.alf</a></li>
            <li><a href="../../modules/kong.tools.io">kong.tools.io</a></li>
            <li><a href="../../modules/kong.tools.responses">kong.tools.responses</a></li>
            <li><a href="../../modules/kong.tools.timestamp">kong.tools.timestamp</a></li>
            <li><a href="../../modules/kong.tools.utils">kong.tools.utils</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </aside>

  <div class="page-content-container">
  <div class="page-content">
    <div class="content">
<h1><code>kong.dao</code></h1>
<p>Operates over entities of a given type in a database table.</p>
<p>An instance of this class is to be instanciated for each entity, and can interact
 with the table representing the entity in the database.</p>

<p> Instanciations of this class are managed by the DAO Factory.</p>

<p> This class provides an abstraction for various databases (PostgreSQL, Cassandra)
 and is responsible for propagating clustering events related to data invalidation,
 as well as foreign constraints when the underlying database does not support them
 (as with Cassandra).</p>



<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
  <tr>
    <td class="name"><a href="#DAO:count">DAO:count (tbl)</a></td>
    <td class="summary">Count the number of rows.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:delete">DAO:delete (tbl)</a></td>
    <td class="summary">Delete a row.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:find">DAO:find (tbl)</a></td>
    <td class="summary">Find a row.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:find_all">DAO:find_all (tbl)</a></td>
    <td class="summary">Find all rows.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:find_page">DAO:find_page (tbl, page_offset, page_size)</a></td>
    <td class="summary">Find a paginated set of rows.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:insert">DAO:insert (tbl, options)</a></td>
    <td class="summary">Insert a row.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:new">DAO:new (db, model_mt, schema, constraints, events_handler)</a></td>
    <td class="summary">Instanciate a DAO.</td>
  </tr>
  <tr>
    <td class="name"><a href="#DAO:update">DAO:update (tbl, filter_keys, options)</a></td>
    <td class="summary">Update a row.</td>
  </tr>
</table>


<h2 class="section-header "><a name="Functions">Functions</a></h2>


<dl class="function">
  <hr />
  <dt>
    <h4><a name="DAO:count">DAO:count</a></h4>
  </dt>
  <dd>
    Count the number of rows.
 Count the number of rows matching the given values.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          (optional) A table containing the fields and values to filter for.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><span class="type">number</span></span>
        count The total count of rows matching the given filter, or total count of rows if no filter was given.
      </li>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:delete">DAO:delete</a></h4>
  </dt>
  <dd>
    Delete a row.
 Delete a row in table related to this instance. Also deletes all rows with a relashionship to the deleted row
 (via foreign key relations). For SQL databases such as PostgreSQL, the underlying implementation
 leverages "FOREIGN KEY" constraints, but for others such as Cassandra, such operations are executed
 manually.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          A table containing the primary key field(s) for this row.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        row A table representing the deleted row
      </li>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:find">DAO:find</a></h4>
  </dt>
  <dd>
    Find a row.
 Find a row by its given, mandatory primary key. All other fields are ignored.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          A table containing the primary key field(s) for this row.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        row The row, or nil if none could be found.
      </li>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:find_all">DAO:find_all</a></h4>
  </dt>
  <dd>
    Find all rows.
 Find all rows in the table, eventually matching the values in the given fields.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          (optional) A table containing the fields and values to search for.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><span class="type">rows</span></span>
        An array of rows.
      </li>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:find_page">DAO:find_page</a></h4>
  </dt>
  <dd>
    Find a paginated set of rows.
 Find a pginated set of rows eventually matching the values in the given fields.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          (optional) A table containing the fields and values to filter for.
        </li>
        <li>
          <code class="parameter">page_offset</code>
          Offset at which to resume pagination.
        </li>
        <li>
          <code class="parameter">page_size</code>
          Size of the page to retrieve (number of rows).
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        rows An array of rows.
      </li>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:insert">DAO:insert</a></h4>
  </dt>
  <dd>
    Insert a row.
 Insert a given Lua table as a row in the related table.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          Table to insert as a row.
        </li>
        <li>
          <code class="parameter">options</code>
          <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          Options to use for this insertion. (<code>ttl</code>: Time-to-live for this row, in seconds)
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        res A table representing the insert row (with fields created during the insertion).
      </li>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:new">DAO:new</a></h4>
  </dt>
  <dd>
    Instanciate a DAO.
 The DAO Factory is responsible for instanciating DAOs for each entity.
 This method is only documented for clarity.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">db</code>
          An instance of the underlying database object (<code>cassandra_db</code> or <code>postgres_db</code>)
        </li>
        <li>
          <code class="parameter">model_mt</code>
          The related model metatable. Such metatables contain, among other things, validation methods.
        </li>
        <li>
          <code class="parameter">schema</code>
          The schema of the entity for which this DAO is instanciated. The schema contains crucial informations about how to interact with the database (fields type, table name, etc...)
        </li>
        <li>
          <code class="parameter">constraints</code>
          A table of contraints built by the DAO Factory. Such constraints are mostly useful for databases without support for foreign keys. SQL databases handle those contraints natively.
        </li>
        <li>
          <code class="parameter">events_handler</code>
          Instance of the events propagation class, used to propagate data invalidation events through the cluster.
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        self
      </li>
    </ul>





  </dd>
  <hr />
  <dt>
    <h4><a name="DAO:update">DAO:update</a></h4>
  </dt>
  <dd>
    Update a row.
 Update a row in the related table. Performe a partial update by default (only fields in <code>tbl</code> will)
 be updated. If asked, can perform a "full" update, replacing the entire entity (assuming it is valid)
 with the one specified in <code>tbl</code> at once.

    <h5>Parameters:</h5>
    <ul>
        <li>
          <code class="parameter">tbl</code>
          <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          A table containing the new values for this row.
        </li>
        <li>
          <code class="parameter">filter_keys</code>
          A table containing the values to select the row to be updated.
        </li>
        <li>
          <code class="parameter">options</code>
          <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
          Options to use for this update. (<code>full</code>: performs a full update of the entity).
        </li>
    </ul>

    <h5>Returns:</h5>
    <ul>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        res A table representing the updated entity.
      </li>
      <li>
        <span class="types"><a class="type" href="http://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        err If an error occured, a table describing the issue.
      </li>
    </ul>





  </dd>
</dl>


    </div>
  </div>
</div>
</div>


    <footer class="footer">
  
    <section class="section subscribe-section" id="newsletter">
  <div class="container">
    <header class="section-header">
      <h4>Keep up with the latest features</h4>
    </header>


    <form action="/" class="subscribe-form">
      <div class="spinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
      </div>

      <div class="alert alert-success" role="alert">Thank You!</div>

      <div class="input-group">
        <input type="email" name="email" placeholder="youre@awesome.com" required/>
        <button class="button button-primary" type="submit">Subscribe</button>
      </div>
    </form>
  </div>
</section>

  

  <div class="footer-bar">
    <div class="container">
      <ul class="footer-social">
        <li>
          <!-- verse link.web with link.share in the header -->
          <div class="fb-share-button" data-href="https://getkong.org" data-layout="button"></div>
        </li>
        <li>
          <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://getkong.org" data-text="KONG - the open-source management layer for APIs and Microservices" data-hashtags="opensource,API,management">Tweet</a>
        </li>
        <li>
          <a class="github-button" href="https://github.com/Mashape/kong" data-icon="octicon-star" data-count-href="/mashape/kong/stargazers" data-count-api="/repos/mashape/kong#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star mashape/kong on GitHub">Star</a>
        </li>
      </ul>
    <span>
      <a href="https://mashape.com">
        <img src="/assets/images/branding-footer.svg" alt="Mashape" width="22" height="26"/>
        &copy; <strong>2016 Mashape Inc</strong>
      </a>
    </span>
      <span class="footer-separator"></span>
      <span class="footer-nav">
        <a href="/license">License</a>
        <a href="/terms">Terms</a>
        <a href="/privacy">Privacy</a>
        <a href="https://www.mashape.com/enterprise/">Enterprise</a>
        <a href="http://blog.mashape.com/category/open-source/" target="_blank">News</a>
      </span>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/assets/app.js?v=1474440736"></script>

    <div id="fb-root"></div>

    <a id="support-bubble" href="https://gitter.im/Mashape/kong" class="js-gitter-toggle-chat-button" data-gitter-toggle-chat-state="true"></a>

    <script id="github-bjs" src="https://buttons.github.io/buttons.js" async defer></script>
    <script id="twitter-wjs" type="text/javascript" src="https://platform.twitter.com/widgets.js" async defer></script>
    <script id="facebook-jssdk" type="text/javascript" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=842731852424506" async defer></script>

    <script type='text/javascript'>
      var _vwo_code=(function(){
      var account_id=125292,
      settings_tolerance=2000,
      library_tolerance=2500,
      use_existing_jquery=true,
      // DO NOT EDIT BELOW THIS LINE
      f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
    </script>

    <script type="text/javascript">
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
        analytics.load("WDj0nSS7hpyxwL3evgbOzK755s0NUye6");
        analytics.page()
      }}();
    </script>

    <script type="text/javascript" src="//mashape.github.io/notification-bar/embed.js" async defer></script>
    <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
  </body>
</html>
